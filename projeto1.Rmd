---
title: "Projeto I"
author: 
  - "Bárbara Oliveira Ribeiro"
  - "Nathalia Gabriella Ferreira dos Santos"
date: "`r Sys.Date()`"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  message=FALSE, 
  warning=FALSE
  )
```

# Introdução

# Metodologia

# Pacotes

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(readxl)
library(patchwork) # para parcionar os graficos
library(kableExtra)
```

# Análises

## Tratamento de dados

### Extraindo dados

Colunas usadas: Dados Atuais, *Dados Gestacionais*, *ELISAs*, *Imunoturbidimetria*,*Doenças Crônicas*

```{r}
rm(list = ls()) # limpa enviroment

df1 <- read_xlsx("dados.xlsx", sheet = "Dados Atuais")
df2 <- read_xlsx("dados.xlsx", sheet = "Dados Gestacionais")
df3 <- read_xlsx("dados.xlsx", sheet = "ELISAs")
df4 <- read_xlsx("dados.xlsx", sheet = "Imunoturbidimetria")
df5 <- read_xlsx("dados.xlsx", sheet = "Doenças Crônicas")
```

**Funções para tratar os dados:**

```{r}
coluna_na_numerica <- function(lista, caracter = ".", substituto = ""){
  lista %>% 
    str_replace(. , pattern = ",", replacement = ".") %>%
    str_replace_na(. , replacement = "") %>% 
    ifelse(. == caracter, substituto, .) %>% as.numeric()
}

coluna_numerica <- function(lista){
  lista %>% 
    ifelse(. == 99999, NA, .) %>% as.numeric()
}
```

#### DF1: Dados Atuais

```{r}
colunas_interesse <- c(
  "GRUPO      MN:0      MP:1",
  "ETNIA                1:branca   2:parda   3:negra",
  "IDADE    anos",
  "ESCOLARIDADE COMPLETA  0: 4ª série completa   1:fundamental completo 2:médio completo 3:ensino técnico completo 4:superior completo 5:pós-graduação completa",
  "NÚMERO GESTAÇÕES",
  "Peso (kg)",
  "IMC",
  "GORDURA (%)",
  "PRESSÃO SISTÓLICA (mmHg)",
  "PRESSÃO DIASTÓLICA (mmHg)",
  "PRESSÃO ARTERIAL MÉDIA",
  "CINTURA (cm)",
  "ABDÔMEN (cm)",
  "QUADRIL (cm)",
  "RELAÇÃO CINTURA/QUADRIL",
  "NEU (10³/µL)",
  "LYM (10³/µL)",
  "NLR",
  "Colesterol total (mg/dL)",
  "HDL (mg/dL)",
  "LDL (mg/dL) DOSADO",
  "VLDL (mg/dL)",
  "Não-HDL (mg/dL)",
  "Triglicérides (mg/dL)",
  "HbA1c (%)",
  "Creatinina (mg/dL)",
  "Ritmo de filtrção glomerular calculado",
  "TGP/ALT",
  "TGO/AST",
  "Ácido Úrico",
  "CK",
  "Gama GT",
  "USA ANTI-HIPERTENSIVO 0:não 1:sim",
  "USA MEDICAMENTO PARA DIABETES 0:não 1:sim",
  "USA MEDICAMENTO PARA HIPERCOLESTEROLEMIA 0:não 1:sim",
  "TABAGISTA 0: não   1:sim" 
  )

renomear_colunas <- c(
  "grupo",
  "etnia",
  "idade",
  "escolaridade",
  "num_gestacoes",
  "peso",
  "imc",
  "gordura",  
  "pressao_sis",
  "pressao_dias",
  "pressao_media", 
  "cintura",
  "abdomen",
  "quadril",
  "cintura_quadril",
  "neu",
  "lym",
  "nlr",
  "colesterol_total",
  "hdl",
  "ldl_dosado",
  "vldl",
  "nao_hdl",
  "triglicerides",
  "hba1c",
  "creatinina",
  "filtr_glomerular",
  "tgp_alt",
  "tgo_ast",
  "acido_urico",
  "ck",
  "gama_gt",
  "anti_hiper",
  "medic_diabetes",
  "medic_hipercol",
  "tabagista"
  )


df1 <- df1 %>% dplyr::select(all_of(colunas_interesse))
colnames(df1) <- renomear_colunas

grupos_nulos <- df1 %>% select(grupo) %>% is.na()
df1 <- df1 %>% 
  filter(! grupos_nulos) %>% 
  mutate(
    grupo = as.factor(grupo),
    etnia = coluna_numerica(etnia),
    escolaridade = as.factor(escolaridade),
    peso = coluna_numerica(peso),
    imc = coluna_na_numerica(imc, "#DIV/0!", NA) %>% coluna_numerica(),
    gordura = coluna_na_numerica(gordura) %>% coluna_numerica(),
    pressao_sis = coluna_numerica(pressao_sis),
    pressao_dias = coluna_numerica(pressao_dias),
    pressao_media = coluna_numerica(pressao_media),
    cintura = coluna_numerica(cintura),
    abdomen = coluna_numerica(abdomen),
    quadril = coluna_numerica(quadril),
    cintura_quadril = coluna_na_numerica(cintura_quadril, "#DIV/0!", NA) %>% coluna_numerica(),
    nlr = coluna_na_numerica(nlr, "#DIV/0!", NA) %>% coluna_numerica(),
    ldl_dosado = coluna_na_numerica(ldl_dosado, "#DIV/0!", NA) %>% coluna_numerica(),
    vldl = coluna_na_numerica(vldl, "#DIV/0!", NA) %>% coluna_numerica(),
    hba1c = coluna_numerica(hba1c),
    creatinina = coluna_numerica(creatinina),
    filtr_glomerular = coluna_na_numerica(filtr_glomerular, "#DIV/0!", NA) %>% coluna_numerica(),
    ck = coluna_numerica(ck)
    )
```

####  DF2: Dados Gestacionais

```{r}
colunas_interesse <- c(
  "GRUPO      MN:0      MP:1",
  "Há quantos anos",
  "PESO BEBÊ (kg)",
  "PARTO                                     0:normal   1:cesariana   2:fórceps  3: induzido",
  "PARTO PREMATURO 0:não      1:sim"
  )

renomear_colunas <- c(
  "grupo",
  "quantos_anos_evento",
  "peso_bebe",
  "tipo_parto",
  "prematuro"
  )


df2 <- df2 %>% select(all_of(colunas_interesse))
colnames(df2) <- renomear_colunas

grupos_nulos <- df2 %>% select(grupo) %>% is.na()
df2 <- df2 %>% 
  filter(! grupos_nulos) %>% 
  mutate(
    grupo = as.factor(grupo),
    quantos_anos_evento = quantos_anos_evento %>% as.numeric(),
    peso_bebe = coluna_numerica(peso_bebe),
    tipo_parto = as.factor(coluna_numerica(tipo_parto)),
    prematuro = as.factor(prematuro)
    )
```

#### DF3: ELISAs

```{r}
colunas_interesse <- c(
 "GRUPO      MN:0      MP:1", 
 "PAI-1 (ng/mL)",
 "Log PAI-1 (ng/mL)",
 "TROMBOMODULINA (ng/mL)",
 "ADMA (ng/mL)",
 "sFlt1 (pg/mL)",
 "Absorbâncias sFlt1",
 "sFlt1 (pg/mL) Ajuste linear (Luiza)",
 "AA-AT1 (ng/mL)"
)
renomear_colunas <- c(
 "grupo", 
 "pai1",
 "logpai1",
 "trombomodulina",
 "adma",
 "sflt1",
 "absor_sflt1",
 "sflt1_ajuste",  
 "aaat1"
)
df3 <- df3 %>% select(all_of(colunas_interesse))
colnames(df3) <- renomear_colunas

df3 <- df3 %>% 
  mutate_all(~ifelse(is.na(.), "", .)) %>% 
  mutate_all(~ifelse(. != "< curva", as.numeric(.), .))

df3 <- df3 %>% mutate(
  pai1 = coluna_numerica(pai1),
  logpai1 = coluna_numerica(logpai1),
  trombomodulina = coluna_numerica(trombomodulina),
  adma = coluna_numerica(adma), 
  sflt1 = coluna_na_numerica(sflt1, "< curva", NA) %>% coluna_numerica(),
  absor_sflt1 = coluna_numerica(absor_sflt1),
  sflt1_ajuste = coluna_numerica(sflt1_ajuste),
  aaat1 = coluna_numerica(aaat1)
)

# corrigindo outro erro de adma
df3$adma <- df3$adma %>% ifelse(. == 999999, NA, .) %>% as.numeric()
```

#### DF4: Imunoturbidimetria

```{r}
colunas_interesse <- c(
 "GRUPO      MN:0      MP:1", 
 "DÍMERO-D (ng/mL)",
 "LOG DÍMERO-D"
)
renomear_colunas <- c(
 "grupo", 
 "dimero",
 "logdimero"
)
df4 <- df4 %>% select(all_of(colunas_interesse))
colnames(df4) <- renomear_colunas

df4 <- df4 %>% 
  mutate_all(~ifelse(is.na(.), "", .)) %>% 
  mutate_all(as.numeric)

# alterando df4
df4 <- df4 %>% mutate(
    dimero = coluna_numerica(dimero)
)

```

#### DF5: Doenças Crônicas

```{r}
colunas_interesse <- c(
 "GRUPO      MN:0      MP:1", 
 "HIPERTENSÃO 0:não   1:sim",
 "DIABETES 0:não   1:sim",
 "HIPERCOLESTEROLEMIA 0:não   1:sim",
 "FIBROMIALGIA 0:não   1:sim",
 "GLAUCOMA 0:não   1:sim",
 "ENXAQUECA 0:não   1:sim",
 "HIPOTIREOIDISMO 0:não   1:sim",
 "ASMA 0:não   1:sim",
 "ESTEATOSE HEPÁTICA 0:não   1:sim",
 "SÍNDROME DO INTESTINO IRRITÁVEL 0:não   1:sim",
 "HEMANGIOMA  0:não   1:sim",
 "TROMBOFILIA  0:não   1:sim",
 "BRONQUITE  0:não   1:sim",
 "RINITE  0:não   1:sim",
 "OVÁRIOS POLICÍSTICOS 0:não   1:sim",
  "Transtorno de ansiedade generalizada (TAG)  0:não   1:sim",
 "SINUSITE 0:não 1:sim",
 "DEPRESSÃO 0:não   1:sim",
 "ARTROSE 0:não   1:sim",
 "LEUCOCITOSE 0:não   1:sim",
 "ANEMIA 0:não   1:sim",
 "SÍNDROME DO PÂNICO 0:não   1:sim",
 "GASTRITE 0:não   1:sim",
 "HEPATITE 0:não   1:sim",
 "CRISE ALÉRGICA 0:não   1:sim",
 "CISTITE 0:não   1:sim",
 "ANEMIA FALCIFORME 0: não 1:sim",
 "MIOMA UTERINO 0: não 1: sim",
 "CÁLCULO RENAL 0: não 1: sim",
 "CALCIFICAÇÃO MAMÁRIA 0: não 1: sim",
 "HIPOGLICEMIA 0: não 1: sim",
 "DERRAME DE VISTA 0: não 1: sim",
 "HIDRADENITE 0: não 1: sim",
 "GLOMERULOESCLEREOSE  0: não 1: sim",
 "PRÉ-DIABETES 0: não 1: sim",
  "BIPOLAR 0: não 1: sim",
  "TDAH 0: não 1: sim",
  "TEA 0: não 1: sim",
  "DOENÇA DE STILL 0: não 1: sim"
)

renomear_colunas <- c(
 "grupo", 
 "hipertensao",
 "diabetes",
 "hipercolesterolemia",
 "fibromialgia",
 "glaucoma",
 "enxaqueca",
 "hipotireoidismo",
 "asma",
 "esteatose_hepatica",
 "sindrome_intestino_irritavel",
 "hemangioma",
 "trombofilia",
 "bronquite",
 "rinite",
 "ovario_policistico",
 "TAG",
 "sinusite",
 "depressao",
 "artrose",
 "leucocitose",
 "anemia",
 "sindrome_panico",
 "gastrite",
 "hepatite",
 "crise_alergica",
 "cistite",
 "anemia_falciforme",
 "mioma_uterino",
 "calculo_renal",
 "calcificacao_mamaria",
 "hipoglicemia",
 "derrame de vista",
 "hidradenite",
 "glomeruloesclerose",
 "pre_diabetes",
 "bipolaridade",
 "TDAH",
 "TEA",
 "Doenca_Still"
)

df5 <- df5 %>% select(all_of(colunas_interesse))
colnames(df5) <- renomear_colunas

df5 <- df5 %>% 
  mutate_all(~ifelse(is.na(.), "", .)) %>% 
  mutate_all(as.numeric)
```

# Descritivas e Testes de Médias

```{r}
cor_verde = c("#4fb6a7")
cor_roxa = c("#652177")

cores = colorRampPalette(c("#4fb6a7","#652177"))
tema = theme_minimal() + 
       theme(axis.title.y = element_text(angle = 90, margin = unit(c(0.3, 0.5, 0.3, 0), "cm")),
             axis.title.x = element_text(margin = unit(c(0.3, 0, 0, 0), "cm")),
             axis.line.x = element_line(linewidth = 0.6, linetype=1),
             axis.line.y = element_line(linewidth = 0.6, linetype=1),
             axis.ticks.y = element_line(linewidth = 0.6, linetype = 1),
             axis.text = element_text(size=10),
             legend.position = "right",
             plot.margin = unit(c(0.3, 0.4, 0.3, 0.4), "cm"),
             plot.subtitle = element_text(hjust = 0.5, vjust= 4))
theme_set(tema)
```

## Funções que serão aplicadas:

* Funções de gráficos numéricos e categóricos

```{r}
graficos <- function(dados, grupo, variavel, texto = "variável"){
  
  dados <- dados %>% 
    mutate(grupo = ifelse(grupo == "0", "Controle", "Tratamento"))
  
  tab <- dados %>% 
    group_by(grupo) %>% 
    summarise(
      `Média` = mean( !!sym(variavel) , na.rm = TRUE) %>% round(2),
      `Des. Padrão`= sd( !!sym(variavel) , na.rm = TRUE) %>% round(2),
      `Nulos` = is.na( !!sym(variavel) ) %>% sum() %>% round(2),
      `Quant.` = n() %>% round()) %>% 
    t()
  
  tabela <- data.frame(
    "Métrica" = row.names(tab)[2:5], 
    "Cont." = as.numeric(tab[c(-1),1]),
    "Trat." = as.numeric(tab[c(-1),2])) %>% 
    as_tibble()
  
  dados <- dados %>% filter(! is.na(variavel) )
  
  g1 <- dados %>%
    ggplot(aes(x = !!sym(grupo), y = !!sym(variavel), fill = !!sym(grupo))) + 
    geom_boxplot() + 
    labs(title = "Descritivas\n", x = "Grupos", y = str_to_upper(variavel), fill = "Grupos") +
    tema +
    scale_fill_manual(values=c(cor_verde, cor_roxa))

  g2 <- dados %>% 
    ggplot(aes(x = !!sym(variavel))) +
    geom_histogram(fill = cor_verde) + 
    labs(y = "Frequência", x = str_to_upper(variavel))
  
  return(
    (g1 + gridExtra::tableGrob(tabela, rows = c("", "","", "")))/ 
      (g2)
  )
  }
```

* Função para gráficos categóricos

```{r}
graficos_categoricos <- function(lista1, lista2, variavel){
  
  tabela <- prop.table(
    table(lista1, lista2), 
    margin = 2) #freq da escolaridade dentro dos grupos, ex: freq do grupo 2 no grupo 1
  
  perc <- data.frame(tabela) %>% 
    mutate(lista1 = ifelse(lista1 == "0", "Controle", "Tratamento")) %>% 
    rename(`Frequência` = Freq)
  
  g1 <- perc %>% 
    ggplot(aes(x = lista2, y = `Frequência` , fill = lista1)) +
    geom_bar(stat='identity') + 
    tema +
    scale_fill_manual(values=c(cor_verde, cor_roxa)) +
    labs(
      x = str_to_title(variavel), 
      title = paste("Frequência de", variavel," por grupo"),
      fill = "Grupo") 
  
  return(g1)
}
```

* Teste de Hipóteses

```{r}
permutacoes <- function(grupo_MN, grupo_MP, n = 10000){
  difobs <- mean(grupo_MN, na.rm = T) - mean(grupo_MP, na.rm = T)
  dif <-numeric(n)
  todos <- c(grupo_MN, grupo_MP)
  todos <- todos[! is.na(todos)]
  set.seed(2023)
  N <- length(todos)

  for (i in 1:n) {
    # permutar dados
    sorteio <- sample(todos, replace = F)
  
    g1_perm <- sorteio[1:(N/2)]
    g2_perm <- sorteio[((N/2)+1):N]
    dif[i] <- mean(g1_perm)-mean(g2_perm)
  }
  valorp<- 2 * length(dif[dif > abs(difobs) ])/n # cauda superior
  alpha <- 0.05
  
  tipo_teste <- "Teste permutação"
  
  #cat(paste("Teste permutação\n",
  #          "Hipotese Alternativa: Medias diferentes para os grupos\n",
  #          paste0("Nivel de significancia de ", alpha),
  #          "pvalor =", valorp), 
  #    "\n", if_else(valorp >= alpha, "Não rejeita-se H0", "Rejeita-se H0"))
  
  return(list(method = tipo_teste, p.value = valorp))
  } 
```


```{r}
realizar_teste <- function(dataframe, variavel) {
  
  dataframefiltrado <- dataframe %>%
    mutate(grupo = ifelse(grupo == "0", "MN", "MP")) 

  grupo_MN<- dataframefiltrado %>%
    filter(grupo == "MN") %>%
    pull(variavel)
  
  grupo_MP<- dataframefiltrado %>%
    filter(grupo == "MP") %>%
    pull(variavel)

  shapiro1 <- shapiro.test(grupo_MN)
  shapiro2 <- shapiro.test(grupo_MP)

  if (shapiro1$p.value <= 0.05 || shapiro2$p.value <= 0.05) {
    permutacoes(grupo_MN, grupo_MP)
  } else {
    resultado_teste <- t.test(grupo_MN, grupo_MP, alternative = "two.sided") 
    return(resultado_teste)
  }
}
```

* Teste de hipóteses para dados categóricos

```{r}
hipo_categorica <- function(dados, grupo, variavel){
  data_grupo <- dados %>% dplyr::select( !!sym(grupo) ) %>% pull( !!sym(grupo) )
  data_variavel <- dados %>% dplyr::select( !!sym(variavel) ) %>% pull( !!sym(variavel) )
  tab = xtabs(~ data_grupo + data_variavel) # tabela de frequencia
  return(fisher.test(tab))
}
```

* Função Resumo hipóteses

```{r}
resumo_testes <- function(teste, variavel){
    pvalor <- teste$p.value
    metodo <- teste$method  
    alpha <- 0.05
    conclusao <- if_else(pvalor >= alpha, "Não rejeita-se H0", "Rejeita-se H0")
    
    lista <- list(
      Nome = variavel,
      `Método` = metodo,
      Pvalor = pvalor,
      `Conclusão` = conclusao)
    
    return(lista %>% as_tibble() )
}
```

## Análise por variável:

### Idade:

```{r}
variavel <- "idade"
graficos(df1, "grupo", variavel)
teste <- realizar_teste(df1, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- resultado
resultado %>% kable(caption = "Título")
```

### Etnia:

```{r}
variavel <- "etnia"
graficos_categoricos(df1$grupo, df1$etnia, variavel)
teste <- hipo_categorica(df1, "grupo", variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- resultado
resultado %>% kable(caption = "Título")

# Tabela de percentual
df_tab1 <- df1 %>% 
  mutate(grupo = ifelse(grupo == 0, "Controle", "Tratamento"))

tab <- df_tab1 %>% 
  mutate(etnia = ifelse(etnia == 1, "Branca",
                         ifelse(etnia == 2, "Parda", "Negra")))
table(
  tab %>% pull(grupo), 
  tab %>% pull(etnia)) %>% 
  prop.table(margin = 1) %>% round(4) * 100
```

### Escolaridade:

```{r}
variavel <- "escolaridade"
graficos_categoricos(df1$grupo, df1$escolaridade, variavel)
teste <- hipo_categorica(df1, "grupo", variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

```{r}
# Tabela de percentual
tab <- df_tab1 %>% 
  mutate(escolaridade = ifelse(escolaridade == 0, "4ª série",
                        ifelse(escolaridade == 1, "Fundamental",
                        ifelse(escolaridade == 2, "Ensino Médio", 
                        ifelse(escolaridade == 3, "Ensino técnico",
                        ifelse(escolaridade == 4, "Superior",
                                                  "Pós-graduação"))))))
  
table(
  tab %>% pull(grupo), 
  tab %>% pull(escolaridade)) %>% 
  prop.table(margin = 1) %>% round(4) * 100
```

### Há quantos anos foi a gestação de interesse :

```{r}
variavel = "num_gestacoes"
graficos_categoricos(df1$grupo, df1$num_gestacoes, "Há quantos anos foi a gestação de interesse ")
teste <- hipo_categorica(df1, "grupo", variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### Peso da mulher:

```{r}
variavel = "peso"
graficos(df1, "grupo", variavel)
teste <- realizar_teste(df1, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### IMC:

```{r}
variavel = "imc"
graficos(df1, "grupo", variavel)
teste <- realizar_teste(df1, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### Percentual de gordura:

```{r}
variavel = "gordura"
graficos(df1, "grupo", variavel)
teste <- realizar_teste(df1, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### Pressão Sistólica:

```{r}
variavel = "pressao_sis"
graficos(df1, "grupo", variavel)
teste <- realizar_teste(df1, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### Pressão Diastólica:

```{r}
variavel = "pressao_dias"
graficos(df1, "grupo", variavel)
teste <- realizar_teste(df1, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### Pressão arterial média:

```{r}
variavel = "pressao_media"
graficos(df1, "grupo", variavel)
teste <- realizar_teste(df1, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### Circunferência de cintura:

```{r}
variavel = "cintura"
graficos(df1, "grupo", variavel)
teste <- realizar_teste(df1, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### Circunferência de abdômen:

```{r}
variavel = "abdomen"
graficos(df1, "grupo", variavel)
teste <- realizar_teste(df1, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### Circunferência de quadril:

```{r}
variavel = "quadril"
graficos(df1, "grupo", variavel)
teste <- realizar_teste(df1, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### Relação cintura vs quadril:

```{r}
variavel = "cintura_quadril"
graficos(df1, "grupo", variavel)
teste <- realizar_teste(df1, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### Neutrófilos:

```{r}
variavel = "neu"
graficos(df1, "grupo", variavel)
teste <- realizar_teste(df1, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### Linfócitos:

```{r}
variavel = "lym"
graficos(df1, "grupo", variavel)
teste <- realizar_teste(df1, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### Razão neutrófilo/linfócito NLR:

Foi encontrado uma observação outlier, ela será retirada. 

* Relação antes da retirada:
```{r}
df1$nlr %>% summary()
df1$nlr[df1$nlr > 6]
```

* Após retirada:

```{r}
df_nlr <- df1 %>% 
  filter(nlr < 6)

df_nlr$nlr %>% summary()
```

```{r}
variavel = "nlr"
graficos(df_nlr, "grupo", variavel)
teste <- realizar_teste(df_nlr, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### Colesterol Total:

```{r}
variavel = "colesterol_total"
graficos(df1, "grupo", variavel)
teste <- realizar_teste(df1, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### HDL:

```{r}
variavel = "hdl"
graficos(df1, "grupo", variavel)
teste <- realizar_teste(df1, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### LDL dosado:

```{r}
variavel = "ldl_dosado"
graficos(df1, "grupo", variavel)
teste <- realizar_teste(df1, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### VLDL:

Foi encontrado observação outlier, elas serão retiradas. 

* Relação antes da retirada:
```{r}
df1$vldl %>% summary()
df1$vldl[df1$vldl > 45]
```

* Após retirada:

```{r}
df_vldl <- df1 %>% 
  filter(vldl < 45)

df_vldl$vldl %>% summary()
```

```{r}
variavel = "vldl"
graficos(df_vldl, "grupo", variavel)
teste <- realizar_teste(df_vldl, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### Não-HDL:

```{r}
variavel = "nao_hdl"
graficos(df1, "grupo", variavel)
teste <- realizar_teste(df1, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### Triglicérides:

Foi encontrado observação outlier, elas serão retiradas. 

* Relação antes da retirada:
```{r}
df1$triglicerides %>% summary()
df1$triglicerides[df1$triglicerides > 300]
```

* Após retirada:

```{r}
df_triglicerides <- df1 %>% 
  filter(triglicerides < 300)

df_triglicerides$triglicerides %>% summary()
```

Não rejeita-se a hipótese nula.

```{r}
variavel = "triglicerides"
graficos(df_triglicerides, "grupo", variavel)
teste <- realizar_teste(df_triglicerides, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### Hemoglobina glicada HbA1c: **Aqui também encontramos influentes mas não tiramos

```{r}
variavel = "hba1c"
graficos(df1, "grupo", variavel)
teste <- realizar_teste(df1, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### Creatinina:

Foi encontrado observação outlier, elas serão retiradas. 

* Relação antes da retirada:
```{r}
df1$creatinina %>% summary()
df1$creatinina[df1$creatinina > 4]
```

* Após retirada:

```{r}
df_creatinina <- df1 %>% 
  filter(creatinina < 4)

df_creatinina$creatinina %>% summary()
```

```{r}
variavel = "hba1c"
graficos(df_creatinina, "grupo", variavel)
teste <- realizar_teste(df_creatinina, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### Ritmo de filtração glomerular:

Foi encontrado observação outlier, elas serão retiradas. 

* Relação antes da retirada:
```{r}
df1$filtr_glomerular %>% summary()
df1$filtr_glomerular[df1$filtr_glomerular > 3200]
```

* Após retirada:

```{r}
df_filtr_glomerular <- df1 %>% 
  filter(filtr_glomerular < 3200)

df_filtr_glomerular$filtr_glomerular %>% summary()
```

Não rejeita-se a hipótese nula.

```{r}
variavel = "filtr_glomerular"
graficos(df_filtr_glomerular, "grupo", variavel)
teste <- realizar_teste(df_filtr_glomerular, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### TGP/ALT:

```{r}
variavel = "tgp_alt"
graficos(df1, "grupo", variavel)
teste <- realizar_teste(df1, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### TGO/AST:

```{r}
variavel = "tgo_ast"
graficos(df1, "grupo", variavel)
teste <- realizar_teste(df1, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### Ácido úrico:

```{r}
variavel = "acido_urico"
graficos(df1, "grupo", variavel)
teste <- realizar_teste(df1, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### CK: ** Erro no teste

```{r}
variavel = "ck"
graficos(df1, "grupo", variavel)

df_filtro <- df1 %>% 
  drop_na(ck)

#teste <- realizar_teste(df1, variavel)

#resultado <- resumo_testes(teste, variavel)
#tabela_resumo <- rbind(tabela_resumo, resultado)
#resultado %>% kable(caption = "Título")

#realizar_teste(df_filtro, "ck")
```

### Gama GT:

```{r}
variavel = "gama_gt"
graficos(df1, "grupo", variavel)
teste <- realizar_teste(df1, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### quantos_anos_evento ** não sei se podemos aplicar esse teste

```{r}
variavel = "quantos_anos_evento"
graficos_categoricos(df2$grupo, 
                     df2$quantos_anos_evento, "quantos anos se passou do evento")

#hipo_categorica(df2, "grupo", variavel)

teste <- realizar_teste(df2, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### Peso do bebê:

```{r}
variavel = "peso_bebe"
graficos(df2, "grupo", variavel) 
teste <- realizar_teste(df2, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### Tipo Parto

```{r}
df2_filtro <- df2 %>% 
  filter(tipo_parto != "<NA>")

variavel = "tipo_parto"
graficos_categoricos(df2_filtro$grupo, df2_filtro$tipo_parto, "Tipo de parto") 
teste <- hipo_categorica(df2, "grupo", variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

```{r}
# Tabela de percentual
df_tab2 <- df2 %>% 
  mutate(grupo = ifelse(grupo == 0, "Controle", "Tratamento"))

tab <- df_tab2 %>% 
  mutate(tipo_parto = ifelse(tipo_parto == 0, "Normal",
                      ifelse(tipo_parto == 1, "Cesariana", 
                      ifelse(tipo_parto == 2, "Fórceps", "Induzido"))))
table(
  tab %>% pull(grupo), 
  tab %>% pull(tipo_parto)) %>% 
  prop.table(margin = 1) %>% round(4) * 100
```

### Prematuro

```{r}
df2_filtro <- df2 %>% 
  filter(prematuro != "<NA>")

variavel = "prematuro"
graficos_categoricos(df2_filtro$grupo, df2_filtro$prematuro, "prematuro") 
teste <- hipo_categorica(df2, "grupo", variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

```{r}
# Tabela de percentual
tab <- df_tab2 %>% 
  mutate(prematuro = ifelse(prematuro == 0, "Não","Sim"))

table(
  tab %>% pull(grupo), 
  tab %>% pull(prematuro)) %>% 
  prop.table(margin = 1) %>% round(4) * 100
```

### PAI-1 ng/mL:

```{r}
variavel = "pai1"
graficos(df3, "grupo", variavel) 
teste <- realizar_teste(df3, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### Trombomodulina ng/mL:

```{r}
variavel = "trombomodulina"
graficos(df3, "grupo", variavel) 
teste <- realizar_teste(df3, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### ADMA ng/mL:

Foi encontrado observação outlier, elas serão retiradas. 

* Relação antes da retirada:
```{r}
df3$adma %>% summary()
#df3$adma[df3$adma > 250]
```

* Após retirada:

```{r}
df_adma <- df3 %>% 
  filter(adma < 250)

df_adma$adma %>% summary()
```

```{r}
variavel = "adma"
graficos(df_adma, "grupo", variavel)
teste <- realizar_teste(df_adma, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### AA-AT1 ng/mL:

```{r}
variavel = "aaat1"
graficos(df3, "grupo", variavel)
teste <- realizar_teste(df3, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### sflt1 ** Obter dados faltantes primeiro

Foi encontrado observação outlier, elas serão retiradas. 

* Relação antes da retirada:
```{r}
df3$sflt1 %>% summary()
#df3$sflt1[df3$sflt1 > 1000]
```

* Após retirada:

```{r}
df_filtro <- df3 %>% 
  filter(sflt1 < 200)

df_filtro$sflt1 %>% summary()
```

```{r}
variavel = "sflt1"
graficos(df_filtro, "grupo", variavel)
teste <- realizar_teste(df_filtro, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### Dímero-D ng/mL:

Foi encontrado observação outlier, elas serão retiradas. 

* Relação antes da retirada:
```{r}
df4$dimero %>% summary()
```

* Após retirada:

```{r}
df_filtro <- df4 %>% 
  filter(dimero < 1000)

df_filtro$dimero %>% summary()
```

```{r}
variavel = "dimero"
graficos(df_filtro, "grupo", variavel)
teste <- realizar_teste(df_filtro, variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

### Hipertensão

```{r}
variavel = "hipertensao"
graficos_categoricos(df5$grupo, df5$hipertensao, "Hipertensão")
teste <- hipo_categorica(df5, "grupo", variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

```{r}
# Tabela de percentual
df_tab5 <- df5 %>% 
  mutate(grupo = ifelse(grupo == 0, "Controle", "Tratamento"))

tab <- df_tab5 %>% 
  mutate(hipertensao = ifelse(hipertensao == 0, "Não","Sim"))

table(
  tab %>% pull(grupo), 
  tab %>% pull(hipertensao)) %>% 
  prop.table(margin = 1) %>% round(4) * 100
```

### Anti-hipertensivo

```{r}
variavel = "anti_hiper"
graficos_categoricos(df1$grupo, df1$anti_hiper, "Anti-hipertensivo")
teste <- hipo_categorica(df1, "grupo", variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

```{r}
# Tabela de percentual
tab <- df_tab1 %>% 
  mutate(anti_hiper = ifelse(anti_hiper == 0, "Não","Sim"))

table(
  tab %>% pull(grupo), 
  tab %>% pull(anti_hiper)) %>% 
  prop.table(margin = 1) %>% round(4) * 100
```

### Diabetes

```{r}
variavel = "diabetes"
graficos_categoricos(df5$grupo, df5$diabetes, "Diabetes")
teste <- hipo_categorica(df5, "grupo", variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

```{r}
# Tabela de percentual
tab <- df_tab5 %>% 
  mutate(diabetes = ifelse(diabetes == 0, "Não","Sim"))

table(
  tab %>% pull(grupo), 
  tab %>% pull(diabetes)) %>% 
  prop.table(margin = 1) %>% round(4) * 100
```

### Medicamento para diabetes

```{r}
variavel = "medic_diabetes"
graficos_categoricos(df1$grupo, df1$medic_diabetes, "Medicamento para diabetes")
teste <- hipo_categorica(df1, "grupo", variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

```{r}
# Tabela de percentual
tab <- df_tab1 %>% 
  mutate(medic_diabetes = ifelse(medic_diabetes == 0, "Não","Sim"))

table(
  tab %>% pull(grupo), 
  tab %>% pull(medic_diabetes)) %>% 
  prop.table(margin = 1) %>% round(4) * 100
```

### Hipercolesterolemia

```{r}
variavel = "hipercolesterolemia"
graficos_categoricos(df5$grupo, df5$hipercolesterolemia,"Hipercolesterolemia")
teste <- hipo_categorica(df5, "grupo", variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

```{r}
# Tabela de percentual
tab <- df_tab5 %>% 
  mutate(hipercolesterolemia = ifelse(hipercolesterolemia == 0, "Não","Sim"))

table(
  tab %>% pull(grupo), 
  tab %>% pull(hipercolesterolemia)) %>% 
  prop.table(margin = 1) %>% round(4) * 100
```

### Medicamento para hipercolesterolemia

```{r}
variavel = "medic_hipercol"
graficos_categoricos(df1$grupo, df1$medic_hipercol, 
                     "Medicamento para hipercolesterolemia")
teste <- hipo_categorica(df1, "grupo", variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

```{r}
# Tabela de percentual
tab <- df_tab1 %>% 
  mutate(medic_hipercol = ifelse(medic_hipercol == 0, "Não","Sim"))

table(
  tab %>% pull(grupo), 
  tab %>% pull(medic_hipercol)) %>% 
  prop.table(margin = 1) %>% round(4) * 100
```

### Fumantes

```{r}
variavel = "tabagista"
graficos_categoricos(df1$grupo, df1$tabagista, "Fumantes")
teste <- hipo_categorica(df1, "grupo", variavel)

resultado <- resumo_testes(teste, variavel)
tabela_resumo <- rbind(tabela_resumo, resultado)
resultado %>% kable(caption = "Título")
```

```{r}
# Tabela de percentual
tab <- df_tab1 %>% 
  mutate(tabagista = ifelse(tabagista == 0, "Não","Sim"))

table(
  tab %>% pull(grupo), 
  tab %>% pull(tabagista)) %>% 
  prop.table(margin = 1) %>% round(4) * 100
```

## Resumo Descritivas

```{r}
tabela_resumo %>% 
  kable(caption = "Título")
```

Resumo Descritivas favoráveis para o estudo das variáveis que impactam na média ou frequência dentro do grupo *Controle* e *Tratamento*.

```{r}
tabela_resumo %>% 
  filter("Conclusão" == "Rejeita-se H0") %>% 
  kable(caption = "Título")
```


# Testes da curva

```{r}
#rm(list = ls()) # limpa enviroment
```

**Variável resposta: Concentração**

**Variável explicativa: Absorbância**

```{r}
newdata <- read_xlsx("curva.xlsx", sheet = "prev")
newdata %>% head()

ajuste <- read_xlsx("curva.xlsx", sheet = "ajust")

resultado <- newdata
resultado$ajust <- ajuste
resultado %>% head()
```

## Curva com base nos dados amostrais

* Modelo Logístico de 4 parâmetros

b = the Hill coefficient;a = min_value;d = max_value;c = EC50.

- Ideia foi achar coeficientes e depois aplicar inversa

- problema: função não está definida abaixo do valor mínimo

- Predict aqui prevê absorbância e não concentração

```{r}
library(drc)

data <- read_xlsx("curva.xlsx", sheet = "certo")
data %>% head()

data.m1 <- drm(abs ~ conc, data = data, 
                   fct = LL.4(names = c("Slope", "Lower Limit", "Upper Limit", "ED50")))

summary(data.m1)
confint(data.m1, level = 0.90) # tds sao sig

par(mfrow = c(1,1))
plot(data.m1, broken=F, xlab="Concentração", ylab="Absorbância", lwd=1.2, 
     cex=1.2, cex.axis=1.2, cex.lab=1.2)

# Extraindo coefs
coefs.data <- setNames(
  data.m1$coefficients,
  c("b", "a", "d", "c")
)
coefs.data

a = coefs.data[2]
b = coefs.data[1]
c = coefs.data[4]
d = coefs.data[3]

prev.x <- function(y){
  x <- c * ( (((a-d)/(y-d))-1)^(1/b) )
  return(x)
}

prev.x(.166)
prev.x(a+0.01)
```

## Curva com base teórica

```{r}
data2 <- read_xlsx("dados_teoricos.xlsx")

data.m2 <- drm(abs ~ conc, data = data2, 
               fct = LL.4(names = c("Slope", "Lower Limit", "Upper Limit", "ED50")))

summary(data.m2)
confint(data.m2, level = 0.90)

plot(data.m2, broken=F, xlab="Concentração", ylab="Absorbância", lwd=1.2, 
     cex=1.2, cex.axis=1.2, cex.lab=1.2)

# Extraindo coefs
coefs.data2 <- setNames(
  data.m2$coefficients,
  c("b", "a", "d", "c")
)
coefs.data2

a = coefs.data2[2]
b = coefs.data2[1]
c = coefs.data2[4]
d = coefs.data2[3]

prev.x <- function(y){
  x <- c * ( (((a-d)/(y-d))-1)^(1/b) )
  return(x)
}

prev.x(.166)
prev.x(a+0.01)
prev.x(0.048)
```

```{r}
new <- data.frame(
  conc = seq(0,50, 0.01)
)

abs_predita <- predict(object = data.m2, new)
new$abs_prev <- abs_predita
new %>% head() # ver se precisamos elevar os dados ao quadrado
```



## Segundo pacote curva

```{r}
library(dr4pl)

## Como os dados se comportam

teste <- dr4pl(dose = data$conc,
             response = data$abs,
             method.init = "logistic")
plot(teste)

teste$parameters

teste2 <- dr4pl(formula = abs~conc,
             data = data,
             method.init = "Mead",
             method.robust = "Tukey" )
plot(teste2)

teste2$parameters
```

Modelo "teste" ficou melhor que o de teste2

```{r}
a = teste$parameters[4] # minimo
b = teste$parameters[3] # 
c = teste$parameters[2] # inflexao/mediana
d = teste$parameters[1] # maximo

prev.x <- function(y){
  x <- c * ( (((a-d)/(y-d))-1)^(1/b) )
  return(x)
}

prev.x(a+0.01)
prev.x(0.166)
```

## Nova estimação

Referência: https://janalin.github.io/analyse-ELISA/results.html

```{r}
library(minpack.lm)

data <- data %>% dplyr::mutate(log2concentration = log2(conc))
levm.fit <- nlsLM(
  abs ~
  Amin + ((Amax - Amin) / (1 + exp(n * (log2concentration - log2EC50)))),
  data = data,
  start = list(Amin = 0, Amax = 1, log2EC50 = 0.5, n = -1), # chutes iniciais
  control = list(maxiter = 500)
)
# Show summary of the fit
summary(levm.fit)
```

> Depois tentar pegar o mínimo ao invés da mediana

```{r}
# Set Amin to blank values
Amin <- min(newdata$abs) # mediana dos valores a serem previsto
# Re-fit with only three free parameters
levm.fit <- nlsLM(
  abs ~
  Amin + ((Amax - Amin) / (1 + exp(n * (log2concentration - log2EC50)))),
  data = data,
  start = list(Amax = 2, log2EC50 = 0.5, n = -1),
  control = list(maxiter = 500)
)
# Check new fit results
summary(levm.fit)
```

```{r}
drc.fit <- drm(abs ~ conc,
  data = data,
  fct = LL2.4(names = c("n", "Amin", "Amax", "EC50"))
)
summary(drc.fit)

plot(drc.fit)

# os residuos ficaram ruins
ggplot(as_tibble(drc.fit$predres)) +
  geom_point(aes(`Predicted values`, Residuals),
    pch = 1, size = 3, color = "cornflowerblue") +
  geom_hline(yintercept = 0, lwd = 0.2)
```

* Predizendo concentracao

```{r}

prev.conc = newdata$abs

n.est <- coef(drc.fit)[1]
#Amin <- coef(drc.fit)[2]
Amax.est <- coef(drc.fit)[3]
log2EC50.est <- log2(coef(drc.fit)[4])

log2concentration.est <- sapply(prev.conc, function(A){(1/n.est) * (log( ((Amax.est - A)/(A - Amin))) + log2EC50.est*n.est)})

# Get confidence intervals
n = nrow(data)

fgh <- deriv(
  log2concentration ~ (1/n) * (log( ((Amax - A)/(A - Amin))) + log2EC50*n),
  c("Amax", "log2EC50", "n"), function(Amax, log2EC50, n, A) {}
)
f.new <- fgh(Amax.est, log2EC50.est, n.est, data$abs)
g.new <- attr(f.new, "gradient")

#drc.fit$predres

#gs <- rowSums((g.new %*% cov.fit) * g.new)
alpha <- 0.05
#delta.f <- sqrt(gs) * qt(1 - alpha/2, 15)
#results <- data %>% 
#  dplyr::mutate(concentration.est = 2^log2concentration.est) %>%
#  dplyr::mutate(log2concentration.est = log2concentration.est) %>%
#  dplyr::mutate(log2conf = delta.f) 

results <- newdata %>% 
  dplyr::mutate(concentration.est = 2^log2concentration.est)

results # resultados ja na escala desejada
```


# Tamanho Amostral

Foi repassado:

As variâncias para a pressão sistólica são:

Grupo MN: 196,90
Grupo MP: 514,95

Será considerado um $\alpha = 5%$ e $\beta = 10%$

```{r}
var1 <- 196.9
var2 <- 514.95
alpha <- 0.05
beta <- 0.1
gama <- 1

z2 <- qnorm(1 - alpha/2)
zbeta <- qnorm(1 - beta)

n = ((var1 + var2) * (z2 + zbeta)^2) / (gama^2) # falta o denominador
n %>% round()
```


# Referências

https://dl.acm.org/doi/pdf/10.1145/503506.503509

https://est.ufba.br/sites/est.ufba.br/files/kim/matd49-aula04-fisher.pdf

https://www.jstor.org/stable/2527460?seq=1
